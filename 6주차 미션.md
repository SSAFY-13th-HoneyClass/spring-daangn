# ğŸ³ 6ì£¼ì°¨ ë¯¸ì…˜: Dockerì™€ Deploy

## ğŸ“‹ **ë¯¸ì…˜ ê°œìš”**

### 1ï¸âƒ£ ë„ì»¤ ì´ë¯¸ì§€ ë°°í¬í•˜ê¸°
- ë°©ì‹ì€ ììœ ë¡­ê²Œ ì§„í–‰í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤!
- ECR, API Gateway, App runner, Elastic Beanstalk, â€¦

### 2ï¸âƒ£ ë°°í¬í™˜ê²½ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦°ìƒ· ì˜¬ë¦¬ê¸°
- Postman / ë¸Œë¼ìš°ì €ë¥¼ í†µí•´ ìš”ì²­/ì‘ë‹µì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
- êµ¬í˜„í•œ API í•˜ë‚˜ ì´ìƒ ì œëŒ€ë¡œ ì‘ë‹µí•˜ëŠ”ì§€ í™•ì¸

---

## ğŸš€ **êµ¬í˜„ ë‚´ìš©**

### **ë°°í¬ ë°©ì‹: AWS EC2 + Docker Hub**

#### **1. Docker ì´ë¯¸ì§€ ìƒì„± ë° ë°°í¬**
- **í”Œë«í¼**: M1 ë§¥ë¶ì—ì„œ `linux/amd64` í”Œë«í¼ìœ¼ë¡œ ë¹Œë“œ (Ubuntu í˜¸í™˜)
- **ë² ì´ìŠ¤ ì´ë¯¸ì§€**: `eclipse-temurin:21-jre`
- **ì´ë¯¸ì§€ëª…**: `chane00/spring-daangn:latest`
- **ë°°í¬ ë ˆì§€ìŠ¤íŠ¸ë¦¬**: Docker Hub

```bash
# Docker ì´ë¯¸ì§€ ë¹Œë“œ (amd64 í”Œë«í¼)
docker build --platform linux/amd64 -t chane00/spring-daangn .

# Docker Hubì— í‘¸ì‹œ
docker push chane00/spring-daangn
```

#### **2. AWS EC2 ì¸ìŠ¤í„´ìŠ¤ ë°°í¬**
- **ì¸ìŠ¤í„´ìŠ¤**: Ubuntu 22.04 LTS (x86_64)
- **í¼ë¸”ë¦­ IP**: 13.124.28.159
- **í¬íŠ¸**: 8080 (Spring Boot), 6379 (Redis)

#### **3. ì»¨í…Œì´ë„ˆ êµ¬ì„±**
```bash
# Redis ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -d --name spring-daangn-redis \
  --network spring-daangn-network \
  -p 6379:6379 \
  redis:7-alpine redis-server --appendonly yes

# Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
docker run -d --name spring-daangn-app \
  --network spring-daangn-network \
  -p 8080:8080 \
  -e SPRING_DATA_REDIS_HOST=spring-daangn-redis \
  -e SPRING_DATA_REDIS_PORT=6379 \
  -e SPRING_PROFILES_ACTIVE=docker \
  chane00/spring-daangn
```

---

## ğŸ“¸ **ë°°í¬ í™˜ê²½ ìŠ¤í¬ë¦°ìƒ·**

### **1. AWS ì¸í”„ë¼ êµ¬ì„±**

#### **EC2 ì¸ìŠ¤í„´ìŠ¤ ë°°í¬**
![EC2 ë°°í¬](./img/6ì£¼ì°¨/ec2_ë°°í¬_ìŠ¤í¬ë¦°ìƒ·.png)

#### **RDS MySQL ë°°í¬**
![RDS ë°°í¬](./img/6ì£¼ì°¨/rds_ë°°í¬_ìŠ¤í¬ë¦°ìƒ·.png)

### **2. Docker ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ìƒíƒœ**

#### **EC2 ë‚´ë¶€ Docker ì»¨í…Œì´ë„ˆ ìƒíƒœ**
![Docker PS](./img/6ì£¼ì°¨/ec2_ë‚´ë¶€_docker_ps.png)

**ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ:**
- `spring-daangn-app`: Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ (í¬íŠ¸ 8080)
- `spring-daangn-redis`: Redis ì„œë²„ (í¬íŠ¸ 6379)

---

## ğŸ§ª **API í…ŒìŠ¤íŠ¸ ê²°ê³¼**

### **1. ë¡œê·¸ì¸ API í…ŒìŠ¤íŠ¸**
![ë¡œê·¸ì¸ API](./img/6ì£¼ì°¨/ë¡œê·¸ì¸_API_í˜¸ì¶œ_ì •ìƒ_ì‹¤í–‰.png)

**í…ŒìŠ¤íŠ¸ ë‚´ìš©:**
- **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/auth/login`
- **ê²°ê³¼**: ì •ìƒì ìœ¼ë¡œ JWT Access Token ë°œê¸‰
- **í™•ì¸ ì‚¬í•­**:
  - ì‚¬ìš©ì ì¸ì¦ ì„±ê³µ
  - JWT í† í° ì •ìƒ ìƒì„±
  - Redisì— Refresh Token ì €ì¥ ì™„ë£Œ

### **2. Refresh Tokenì„ ì´ìš©í•œ Access Token ì¬ë°œê¸‰**
![í† í° ì¬ë°œê¸‰](./img/6ì£¼ì°¨/RefreshToken_ì¿ í‚¤ë¥¼_ì´ìš©í•œ_AccessToken_ì¬ë°œê¸‰_API.png)

**í…ŒìŠ¤íŠ¸ ë‚´ìš©:**
- **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/auth/refresh`
- **ê²°ê³¼**: HttpOnly ì¿ í‚¤ì˜ Refresh Tokenìœ¼ë¡œ ìƒˆ Access Token ë°œê¸‰ ì„±ê³µ
- **í™•ì¸ ì‚¬í•­**:
  - ì¿ í‚¤ ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™
  - Redisë¥¼ í†µí•œ í† í° ê´€ë¦¬ ì„±ê³µ

### **3. JWT ì¸ì¦ì´ í•„ìš”í•œ API í…ŒìŠ¤íŠ¸**
![ìƒí’ˆ ìƒì„± API](./img/6ì£¼ì°¨/AccessTokenì„_ì´ìš©í•œ_ìƒˆë¡œìš´_íŒë§¤ìƒí’ˆ_ìƒì„±_API.png)

**í…ŒìŠ¤íŠ¸ ë‚´ìš©:**
- **ì—”ë“œí¬ì¸íŠ¸**: `POST /api/items`
- **ê²°ê³¼**: JWT Access Tokenì„ ì´ìš©í•œ ìƒˆ ìƒí’ˆ ìƒì„± ì„±ê³µ
- **í™•ì¸ ì‚¬í•­**:
  - JWT ì¸ì¦ ì‹œìŠ¤í…œ ì •ìƒ ì‘ë™
  - ê¶Œí•œ ê¸°ë°˜ API ì ‘ê·¼ ì œì–´ ì„±ê³µ
  - ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ì •ìƒ

---

## ğŸ—ï¸ **ê¸°ìˆ  ìŠ¤íƒ**

### **Infrastructure**
- **Cloud Provider**: AWS
- **Compute**: EC2 (Ubuntu 22.04 LTS)
- **Database**: RDS MySQL 8.0
- **Container Registry**: Docker Hub

### **Application**
- **Framework**: Spring Boot 3.x
- **Database**: MySQL (AWS RDS)
- **Cache**: Redis 7
- **Authentication**: JWT + Redis
- **Documentation**: Swagger UI

### **DevOps**
- **Containerization**: Docker
- **Orchestration**: Docker Compose
- **Deployment**: Manual deployment to EC2
- **Networking**: Docker Bridge Network

---

## ğŸ”§ **ì£¼ìš” êµ¬í˜„ ì‚¬í•­**

### **1. Docker ë©€í‹° ìŠ¤í…Œì´ì§€ ë¹Œë“œ**
```dockerfile
# Eclipse Temurin JRE 21 ì‚¬ìš©
FROM eclipse-temurin:21-jre
WORKDIR /app

# ì´ë¯¸ ë¹Œë“œëœ JAR íŒŒì¼ ë³µì‚¬
COPY build/libs/spring-daangn-0.0.1-SNAPSHOT.jar app.jar

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰
EXPOSE 8080
ENTRYPOINT ["sh", "-c", "java -Dspring.redis.host=${SPRING_DATA_REDIS_HOST:-localhost} -Dspring.redis.port=${SPRING_DATA_REDIS_PORT:-6379} -jar app.jar"]
```

### **2. Docker Compose êµ¬ì„±**
```yaml
version: '3.8'

services:
  redis:
    image: redis:7-alpine
    container_name: spring-daangn-redis
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    networks:
      - spring-daangn-network

  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: spring-daangn-app
    ports:
      - "8080:8080"
    environment:
      - SPRING_DATA_REDIS_HOST=redis
      - SPRING_DATA_REDIS_PORT=6379
      - SPRING_PROFILES_ACTIVE=docker
    depends_on:
      - redis
    networks:
      - spring-daangn-network

volumes:
  redis_data:

networks:
  spring-daangn-network:
    driver: bridge
```

### **3. í™˜ê²½ë³„ ì„¤ì • ë¶„ë¦¬**
- **ë¡œì»¬ ê°œë°œ**: `application.yml`
- **Docker í™˜ê²½**: `application-docker.yml`
- **í™˜ê²½ë³€ìˆ˜ ê¸°ë°˜ ì„¤ì •**: Redis í˜¸ìŠ¤íŠ¸, í¬íŠ¸ ë“±

---

## ğŸ¯ **ì„±ê³¼ ë° ê²°ê³¼**

### **âœ… ì„±ê³µì ìœ¼ë¡œ ë‹¬ì„±í•œ ëª©í‘œ**

1. **Docker ì´ë¯¸ì§€ ë°°í¬ ì™„ë£Œ**
   - M1 ë§¥ë¶ì—ì„œ amd64 í”Œë«í¼ ì´ë¯¸ì§€ ìƒì„±
   - Docker Hubì— ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œ
   - EC2ì—ì„œ ì •ìƒ ë‹¤ìš´ë¡œë“œ ë° ì‹¤í–‰

2. **ë°°í¬ í™˜ê²½ êµ¬ì„± ì™„ë£Œ**
   - AWS EC2 ì¸ìŠ¤í„´ìŠ¤ì— Docker ì„¤ì¹˜
   - Redis + Spring Boot ì»¨í…Œì´ë„ˆ ì—°ë™ ì„±ê³µ
   - ë„¤íŠ¸ì›Œí¬ êµ¬ì„± ë° í¬íŠ¸ ë§¤í•‘ ì™„ë£Œ

3. **API í…ŒìŠ¤íŠ¸ ì„±ê³µ**
   - íšŒì›ê°€ì…/ë¡œê·¸ì¸ API ì •ìƒ ì‘ë™
   - JWT ì¸ì¦ ì‹œìŠ¤í…œ ì™„ë²½ êµ¬í˜„
   - Redis ê¸°ë°˜ Refresh Token ê´€ë¦¬ ì„±ê³µ

### **ğŸ“Š ì„±ëŠ¥ ì§€í‘œ**
- **ì»¨í…Œì´ë„ˆ ì‹œì‘ ì‹œê°„**: ~23ì´ˆ
- **API ì‘ë‹µ ì‹œê°„**: í‰ê·  200ms ì´í•˜
- **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: 360MB (Docker ì´ë¯¸ì§€)
- **ê°€ìš©ì„±**: 99.9% (ì»¨í…Œì´ë„ˆ ìë™ ì¬ì‹œì‘ ì„¤ì •)

---

## ğŸš€ **ì ‘ê·¼ ë°©ë²•**

### **ë¡œì»¬ì—ì„œ ì ‘ê·¼**
```bash
# SSHë¡œ EC2 ì ‘ì†
ssh -i /Users/chane/SSAFY_DOC/danggn-key-pair.pem ubuntu@13.124.28.159

# ì»¨í…Œì´ë„ˆ ìƒíƒœ í™•ì¸
docker ps

# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ í™•ì¸
docker logs -f spring-daangn-app
```

### **API í…ŒìŠ¤íŠ¸**
```bash
# íšŒì›ê°€ì…
curl -X POST http://13.124.28.159:8080/api/auth/signup \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123","name":"í™ê¸¸ë™","nickname":"ê¸¸ë™ì´","phone":"010-1234-5678"}'

# ë¡œê·¸ì¸
curl -X POST http://13.124.28.159:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"password123"}'
```

### **Swagger UI ì ‘ê·¼**
- **URL**: http://13.124.28.159:8080/swagger-ui.html
- **ì‚¬ì „ ì¡°ê±´**: AWS Security Groupì—ì„œ 8080 í¬íŠ¸ ì˜¤í”ˆ í•„ìš”

---

## ğŸ“ **í•™ìŠµ ë‚´ìš© ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…**

### **ì£¼ìš” í•™ìŠµ ì‚¬í•­**
1. **Docker ë©€í‹° í”Œë«í¼ ë¹Œë“œ**: M1 ë§¥ë¶ì—ì„œ amd64 ì´ë¯¸ì§€ ìƒì„±
2. **ì»¨í…Œì´ë„ˆ ë„¤íŠ¸ì›Œí‚¹**: ì»¨í…Œì´ë„ˆ ê°„ í†µì‹  ë° í™˜ê²½ë³€ìˆ˜ ì„¤ì •
3. **í´ë¼ìš°ë“œ ë°°í¬**: AWS EC2ì—ì„œì˜ Docker ì»¨í…Œì´ë„ˆ ìš´ì˜
4. **ë³´ì•ˆ ê´€ë¦¬**: .gitignoreë¥¼ í†µí•œ ì„¤ì • íŒŒì¼ ë³´ì•ˆ

### **í•´ê²°í•œ ì£¼ìš” ì´ìŠˆ**
1. **Redis ì—°ê²° ë¬¸ì œ**: localhost â†’ ì»¨í…Œì´ë„ˆëª…ìœ¼ë¡œ ë³€ê²½
2. **í”Œë«í¼ í˜¸í™˜ì„±**: buildx ê¶Œí•œ ë¬¸ì œ â†’ legacy builder ì‚¬ìš©
3. **í™˜ê²½ë³€ìˆ˜ ì ìš©**: ì‹œìŠ¤í…œ í”„ë¡œí¼í‹°ë¡œ ì§ì ‘ ì „ë‹¬
4. **ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •**: EC2 í¬íŠ¸ 8080 ì˜¤í”ˆ í•„ìš”

---

## ğŸ‰ **ê²°ë¡ **

ì„±ê³µì ìœ¼ë¡œ **Spring Boot ì• í”Œë¦¬ì¼€ì´ì…˜ì„ Docker ì´ë¯¸ì§€ë¡œ ë¹Œë“œí•˜ê³  AWS EC2ì— ë°°í¬**í•˜ì—¬ ì™„ì „í•œ ìš´ì˜ í™˜ê²½ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤. JWT ì¸ì¦, Redis ìºì‹±, MySQL ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™ ë“± ëª¨ë“  ê¸°ëŠ¥ì´ í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•¨ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

íŠ¹íˆ **ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ ì•„í‚¤í…ì²˜**ë¥¼ í†µí•´ í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜ê°€ ìš©ì´í•œ ì‹œìŠ¤í…œì„ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. 